<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ì»¤ ì¸ì‚¬ì´íŠ¸ ë””ë²„ê·¸ ìƒíƒœ</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            margin: 20px; 
            background: #1a1a1a; 
            color: #00ff00; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: #000; 
            padding: 20px; 
            border-radius: 10px; 
            border: 1px solid #333; 
        }
        .status-item { 
            margin: 10px 0; 
            padding: 10px; 
            background: #111; 
            border-left: 4px solid #00ff00; 
        }
        .error { border-left-color: #ff0000; color: #ff6666; }
        .warning { border-left-color: #ffaa00; color: #ffcc66; }
        .success { border-left-color: #00ff00; color: #66ff66; }
        .info { border-left-color: #0088ff; color: #66ccff; }
        
        pre { 
            background: #222; 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto; 
            white-space: pre-wrap; 
        }
        
        .timestamp { 
            color: #888; 
            font-size: 0.9em; 
        }
        
        #log-container {
            height: 400px;
            overflow-y: auto;
            background: #111;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-error { background: #330000; color: #ff6666; }
        .log-warn { background: #332200; color: #ffcc66; }
        .log-info { background: #003300; color: #66ff66; }
        .log-debug { background: #001133; color: #66ccff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ í¬ì»¤ ì¸ì‚¬ì´íŠ¸ ë””ë²„ê·¸ ìƒíƒœ v1.3.1</h1>
        <p class="timestamp">ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§ - <span id="current-time"></span></p>
        
        <div class="status-item success">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <div id="system-status">ì´ˆê¸°í™” ì¤‘...</div>
        </div>
        
        <div class="status-item info">
            <h3>ğŸŒ ë¦¬ì†ŒìŠ¤ ìƒíƒœ</h3>
            <div id="resource-status">í™•ì¸ ì¤‘...</div>
        </div>
        
        <div class="status-item warning">
            <h3>ğŸ“‹ ì‹¤í–‰ ë¡œê·¸</h3>
            <div id="log-container"></div>
        </div>
        
        <div class="status-item info">
            <h3>ğŸ“ˆ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
            <pre id="data-preview">ë¡œë”© ì¤‘...</pre>
        </div>
    </div>

    <script>
        // ë¡œê·¸ ê´€ë¦¬
        const logContainer = document.getElementById('log-container');
        const logs = [];
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                type,
                message,
                id: Date.now()
            };
            
            logs.push(logEntry);
            
            const logEl = document.createElement('div');
            logEl.className = `log-entry log-${type}`;
            logEl.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logEl);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ë¡œê·¸ ê°œìˆ˜ ì œí•œ
            if (logs.length > 50) {
                logs.shift();
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        async function checkSystemStatus() {
            const statusEl = document.getElementById('system-status');
            
            try {
                addLog('info', 'ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹œì‘');
                
                // ë¸Œë¼ìš°ì € ì •ë³´
                const browserInfo = {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine
                };
                
                // í™”ë©´ ì •ë³´
                const screenInfo = {
                    width: screen.width,
                    height: screen.height,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth
                };
                
                const status = `
                    <strong>ë¸Œë¼ìš°ì €:</strong> ${browserInfo.userAgent}<br>
                    <strong>ì–¸ì–´:</strong> ${browserInfo.language}<br>
                    <strong>í”Œë«í¼:</strong> ${browserInfo.platform}<br>
                    <strong>ì¿ í‚¤ í™œì„±í™”:</strong> ${browserInfo.cookieEnabled}<br>
                    <strong>ì˜¨ë¼ì¸ ìƒíƒœ:</strong> ${browserInfo.onLine}<br>
                    <strong>í™”ë©´ í•´ìƒë„:</strong> ${screenInfo.width}x${screenInfo.height}<br>
                    <strong>ìƒ‰ìƒ ê¹Šì´:</strong> ${screenInfo.colorDepth}bit
                `;
                
                statusEl.innerHTML = status;
                addLog('info', 'ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
                
            } catch (error) {
                statusEl.innerHTML = `<span style="color: #ff6666;">ì˜¤ë¥˜: ${error.message}</span>`;
                addLog('error', `ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸
        async function checkResourceStatus() {
            const statusEl = document.getElementById('resource-status');
            
            try {
                addLog('info', 'ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸ ì‹œì‘');
                
                const resources = [
                    { name: 'Chart.js CDN', url: 'https://cdn.jsdelivr.net/npm/chart.js' },
                    { name: 'Supabase í†µí•© ìŠ¤í¬ë¦½íŠ¸', url: './supabase-integration.js' },
                    { name: 'API ë°ì´í„°', url: './api_data.json' },
                    { name: 'ë©”ì¸ ëŒ€ì‹œë³´ë“œ', url: './index.html' }
                ];
                
                const results = [];
                
                for (const resource of resources) {
                    try {
                        const response = await fetch(resource.url, { method: 'HEAD' });
                        const status = response.ok ? 'âœ… ì •ìƒ' : `âŒ ${response.status}`;
                        results.push(`<strong>${resource.name}:</strong> ${status}`);
                        addLog('info', `${resource.name}: ${status}`);
                    } catch (error) {
                        results.push(`<strong>${resource.name}:</strong> âŒ ì˜¤ë¥˜`);
                        addLog('error', `${resource.name}: ${error.message}`);
                    }
                }
                
                statusEl.innerHTML = results.join('<br>');
                addLog('info', 'ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
                
            } catch (error) {
                statusEl.innerHTML = `<span style="color: #ff6666;">ì˜¤ë¥˜: ${error.message}</span>`;
                addLog('error', `ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
        async function loadDataPreview() {
            const previewEl = document.getElementById('data-preview');
            
            try {
                addLog('info', 'API ë°ì´í„° ë¡œë”© ì‹œì‘');
                
                const response = await fetch('./api_data.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                const preview = {
                    version: 'ë°ì´í„°ì—ì„œ í™•ì¸ëœ ë²„ì „ ì •ë³´ ì—†ìŒ',
                    last_updated: data.last_updated,
                    total_sites: data.summary?.total_sites || 0,
                    total_players: data.summary?.latest_total_players || 0,
                    data_points: data.summary?.data_points || 0,
                    sites_sample: Object.keys(data.sites || {}).slice(0, 5)
                };
                
                previewEl.textContent = JSON.stringify(preview, null, 2);
                addLog('info', `API ë°ì´í„° ë¡œë”© ì™„ë£Œ: ${preview.total_sites}ê°œ ì‚¬ì´íŠ¸, ${preview.total_players}ëª… í”Œë ˆì´ì–´`);
                
            } catch (error) {
                previewEl.textContent = `ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`;
                addLog('error', `API ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìƒíƒœ í™•ì¸
        async function checkMainDashboard() {
            try {
                addLog('info', 'ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìƒíƒœ í™•ì¸ ì‹œì‘');
                
                // iframeìœ¼ë¡œ ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì‹œë„
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = './index.html';
                
                document.body.appendChild(iframe);
                
                iframe.onload = function() {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const loadingEl = iframeDoc.getElementById('loading-indicator');
                        const titleEl = iframeDoc.querySelector('h1');
                        
                        if (titleEl) {
                            const version = titleEl.textContent.match(/v(\d+\.\d+\.\d+)/);
                            addLog('info', `ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë²„ì „: ${version ? version[1] : 'í™•ì¸ ë¶ˆê°€'}`);
                        }
                        
                        if (loadingEl) {
                            const loadingVisible = window.getComputedStyle(loadingEl).display !== 'none';
                            addLog(loadingVisible ? 'warn' : 'info', 
                                  `ë¡œë”© ì¸ë””ì¼€ì´í„° ìƒíƒœ: ${loadingVisible ? 'í‘œì‹œë¨ (ë¬´í•œ ë¡œë”© ê°€ëŠ¥ì„±)' : 'ìˆ¨ê²¨ì§ (ì •ìƒ)'}`);
                        }
                        
                    } catch (e) {
                        addLog('warn', `ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë‚´ë¶€ í™•ì¸ ì‹¤íŒ¨ (CORS ì œí•œ): ${e.message}`);
                    }
                    
                    document.body.removeChild(iframe);
                };
                
                iframe.onerror = function() {
                    addLog('error', 'ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨');
                    document.body.removeChild(iframe);
                };
                
            } catch (error) {
                addLog('error', `ë©”ì¸ ëŒ€ì‹œë³´ë“œ í™•ì¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ì´ˆê¸°í™”
        async function initialize() {
            addLog('info', 'ë””ë²„ê·¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘');
            
            updateTime();
            setInterval(updateTime, 1000);
            
            await checkSystemStatus();
            await checkResourceStatus();
            await loadDataPreview();
            await checkMainDashboard();
            
            addLog('info', 'ë””ë²„ê·¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ì£¼ê¸°ì  ìƒíƒœ í™•ì¸
            setInterval(async () => {
                await checkResourceStatus();
                await loadDataPreview();
            }, 30000); // 30ì´ˆë§ˆë‹¤
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>