<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸´ê¸‰ ë””ë²„ê·¸ - í¬ì»¤ ì¸ì‚¬ì´íŠ¸</title>
    <style>
        body { 
            font-family: monospace; 
            background: #000; 
            color: #0f0; 
            margin: 20px; 
            line-height: 1.6; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: #111; 
            padding: 20px; 
            border: 1px solid #333; 
        }
        .error { color: #f44; }
        .warning { color: #fa0; }
        .success { color: #4f4; }
        .info { color: #4af; }
        pre { 
            background: #222; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            white-space: pre-wrap; 
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border-left: 4px solid #4af; 
            background: #0a0a0a; 
        }
        .critical { border-left-color: #f44; }
        .test-btn {
            background: #333;
            color: #0f0;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
            font-family: monospace;
        }
        .test-btn:hover { background: #555; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ ê¸´ê¸‰ ë””ë²„ê·¸ ëª¨ë“œ - í¬ì»¤ ì¸ì‚¬ì´íŠ¸ v1.3.1</h1>
        <p>ë¬´í•œ ë¡œë”© ë¬¸ì œ ì§„ë‹¨ ë„êµ¬</p>
        
        <div class="section">
            <h3>ğŸ”§ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-btn" onclick="testMainPageLoad()">ë©”ì¸ í˜ì´ì§€ ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
            <button class="test-btn" onclick="testJavaScriptExecution()">JavaScript ì‹¤í–‰ í…ŒìŠ¤íŠ¸</button>
            <button class="test-btn" onclick="testAPIData()">API ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
            <button class="test-btn" onclick="testChartJS()">Chart.js ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
            <button class="test-btn" onclick="simulateMainDashboard()">ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì‹œë®¬ë ˆì´ì…˜</button>
            <button class="test-btn" onclick="runFullDiagnosis()">ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        </div>
        
        <div class="section" id="results">
            <h3>ğŸ“Š ì§„ë‹¨ ê²°ê³¼</h3>
            <div id="output">í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”...</div>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : 
                             type === 'warning' ? 'warning' : 
                             type === 'success' ? 'success' : 'info';
            
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clear() {
            output.innerHTML = '';
        }
        
        // ë©”ì¸ í˜ì´ì§€ ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function testMainPageLoad() {
            clear();
            log('info', '=== ë©”ì¸ í˜ì´ì§€ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            try {
                const response = await fetch('./index.html');
                const html = await response.text();
                
                log('success', `ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì„±ê³µ (${html.length} bytes)`);
                
                // ì¤‘ìš” ìš”ì†Œ í™•ì¸
                const checks = [
                    ['Chart.js CDN', html.includes('cdn.jsdelivr.net/npm/chart.js')],
                    ['Supabase ìŠ¤í¬ë¦½íŠ¸', html.includes('supabase-integration.js')],
                    ['DOMContentLoaded', html.includes('DOMContentLoaded')],
                    ['initializeDashboard', html.includes('initializeDashboard')],
                    ['loadDashboardData', html.includes('loadDashboardData')],
                    ['loading-indicator ID', html.includes('id="loading-indicator"')],
                    ['total-sites ID', html.includes('id="total-sites"')],
                    ['total-players ID', html.includes('id="total-players"')]
                ];
                
                checks.forEach(([name, found]) => {
                    log(found ? 'success' : 'error', `${name}: ${found ? 'âœ“' : 'âœ—'}`);
                });
                
                // ë²„ì „ í™•ì¸
                const versionMatch = html.match(/v(\d+\.\d+\.\d+)/);
                if (versionMatch) {
                    log('info', `ë°œê²¬ëœ ë²„ì „: ${versionMatch[1]}`);
                } else {
                    log('warning', 'ë²„ì „ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
            } catch (error) {
                log('error', `ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // JavaScript ì‹¤í–‰ í…ŒìŠ¤íŠ¸
        async function testJavaScriptExecution() {
            clear();
            log('info', '=== JavaScript ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            try {
                // ê¸°ë³¸ JavaScript ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                log('info', 'fetch API ì§€ì›: ' + (typeof fetch !== 'undefined' ? 'âœ“' : 'âœ—'));
                log('info', 'async/await ì§€ì›: ' + (async function(){return true;} ? 'âœ“' : 'âœ—'));
                log('info', 'AbortController ì§€ì›: ' + (typeof AbortController !== 'undefined' ? 'âœ“' : 'âœ—'));
                log('info', 'Promise ì§€ì›: ' + (typeof Promise !== 'undefined' ? 'âœ“' : 'âœ—'));
                
                // DOM ì¡°ì‘ í…ŒìŠ¤íŠ¸
                const testDiv = document.createElement('div');
                testDiv.id = 'test-element';
                testDiv.style.display = 'none';
                document.body.appendChild(testDiv);
                
                const found = document.getElementById('test-element');
                log(found ? 'success' : 'error', 'DOM ìš”ì†Œ ìƒì„±/ì¡°íšŒ í…ŒìŠ¤íŠ¸: ' + (found ? 'âœ“' : 'âœ—'));
                
                document.body.removeChild(testDiv);
                
                // ì½˜ì†” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                log('info', 'console.log ì§€ì›: ' + (typeof console !== 'undefined' && typeof console.log === 'function' ? 'âœ“' : 'âœ—'));
                log('info', 'console.error ì§€ì›: ' + (typeof console !== 'undefined' && typeof console.error === 'function' ? 'âœ“' : 'âœ—'));
                
                log('success', 'JavaScript ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                log('error', `JavaScript ì‹¤í–‰ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // API ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testAPIData() {
            clear();
            log('info', '=== API ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            try {
                const response = await fetch('./api_data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('success', 'API ë°ì´í„° ë¡œë“œ ì„±ê³µ');
                
                // ë°ì´í„° êµ¬ì¡° ê²€ì¦
                const requiredKeys = ['summary', 'sites', 'last_updated'];
                requiredKeys.forEach(key => {
                    const found = key in data;
                    log(found ? 'success' : 'error', `í•„ìˆ˜ í‚¤ '${key}': ${found ? 'âœ“' : 'âœ—'}`);
                });
                
                if (data.summary) {
                    log('info', `ì‚¬ì´íŠ¸ ìˆ˜: ${data.summary.total_sites || 'N/A'}`);
                    log('info', `ì´ í”Œë ˆì´ì–´: ${data.summary.latest_total_players || 'N/A'}`);
                    log('info', `ë°ì´í„° í¬ì¸íŠ¸: ${data.summary.data_points || 'N/A'}`);
                }
                
                if (data.sites) {
                    const siteCount = Object.keys(data.sites).length;
                    log('info', `ì‹¤ì œ ì‚¬ì´íŠ¸ ë°ì´í„°: ${siteCount}ê°œ`);
                    
                    if (siteCount > 0) {
                        const firstSite = Object.values(data.sites)[0];
                        const hasData = firstSite.data && Array.isArray(firstSite.data.players_online);
                        log(hasData ? 'success' : 'error', `ì‚¬ì´íŠ¸ ë°ì´í„° êµ¬ì¡°: ${hasData ? 'âœ“' : 'âœ—'}`);
                    }
                }
                
            } catch (error) {
                log('error', `API ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // Chart.js ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function testChartJS() {
            clear();
            log('info', '=== Chart.js ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            try {
                // Chart.js CDN ì‘ë‹µ í™•ì¸
                const response = await fetch('https://cdn.jsdelivr.net/npm/chart.js');
                log('success', `Chart.js CDN ì‘ë‹µ: HTTP ${response.status}`);
                
                // Chart ê°ì²´ í™•ì¸
                if (typeof Chart !== 'undefined') {
                    log('success', 'Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¨');
                    log('info', `Chart.js ë²„ì „: ${Chart.version || 'Unknown'}`);
                } else {
                    log('warning', 'Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                    
                    // ë™ì ìœ¼ë¡œ Chart.js ë¡œë“œ ì‹œë„
                    log('info', 'Chart.js ë™ì  ë¡œë“œ ì‹œë„...');
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                    script.onload = () => {
                        log('success', 'Chart.js ë™ì  ë¡œë“œ ì„±ê³µ');
                        log('info', `Chart.js ë²„ì „: ${Chart.version || 'Unknown'}`);
                    };
                    script.onerror = () => {
                        log('error', 'Chart.js ë™ì  ë¡œë“œ ì‹¤íŒ¨');
                    };
                    document.head.appendChild(script);
                }
                
            } catch (error) {
                log('error', `Chart.js í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì‹œë®¬ë ˆì´ì…˜
        async function simulateMainDashboard() {
            clear();
            log('info', '=== ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ===');
            
            try {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œì˜ ì£¼ìš” í•¨ìˆ˜ë“¤ì„ ì‹œë®¬ë ˆì´ì…˜
                log('info', '1ë‹¨ê³„: ë°ì´í„° ë¡œë”© ì‹œë®¬ë ˆì´ì…˜');
                
                const apiData = await fetch('./api_data.json').then(r => r.json());
                log('success', 'ë°ì´í„° ë¡œë”© ì„±ê³µ');
                
                log('info', '2ë‹¨ê³„: DOM ìš”ì†Œ í™•ì¸');
                
                // ê°€ìƒì˜ DOM ìš”ì†Œ ìƒì„±
                const mockElements = {
                    'loading-indicator': document.createElement('div'),
                    'total-sites': document.createElement('div'),
                    'total-players': document.createElement('div'),
                    'error-container': document.createElement('div')
                };
                
                Object.entries(mockElements).forEach(([id, element]) => {
                    element.id = id;
                    if (id === 'loading-indicator') {
                        element.style.display = 'block'; // ì´ˆê¸°ì— í‘œì‹œ
                    }
                    document.body.appendChild(element);
                });
                
                log('success', 'DOM ìš”ì†Œ ìƒì„± ì™„ë£Œ');
                
                log('info', '3ë‹¨ê³„: í†µê³„ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜');
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                mockElements['total-sites'].textContent = apiData.summary.total_sites;
                mockElements['total-players'].textContent = apiData.summary.latest_total_players.toLocaleString();
                
                log('success', `í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${apiData.summary.total_sites}ê°œ ì‚¬ì´íŠ¸, ${apiData.summary.latest_total_players}ëª… í”Œë ˆì´ì–´`);
                
                log('info', '4ë‹¨ê³„: ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€');
                
                // ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€
                mockElements['loading-indicator'].style.display = 'none';
                
                const isHidden = mockElements['loading-indicator'].style.display === 'none';
                log(isHidden ? 'success' : 'error', `ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€: ${isHidden ? 'âœ“' : 'âœ—'}`);
                
                log('success', 'ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ');
                
                // ì •ë¦¬
                setTimeout(() => {
                    Object.values(mockElements).forEach(element => {
                        if (element.parentNode) {
                            element.parentNode.removeChild(element);
                        }
                    });
                }, 5000);
                
            } catch (error) {
                log('error', `ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ì „ì²´ ì§„ë‹¨
        async function runFullDiagnosis() {
            clear();
            log('info', 'ğŸš¨ ì „ì²´ ì§„ë‹¨ ì‹œì‘ ğŸš¨');
            
            await testMainPageLoad();
            log('info', '---');
            await testJavaScriptExecution();
            log('info', '---');
            await testAPIData();
            log('info', '---');
            await testChartJS();
            log('info', '---');
            await simulateMainDashboard();
            
            log('success', 'ğŸ ì „ì²´ ì§„ë‹¨ ì™„ë£Œ');
            
            // ê¶Œì¥ì‚¬í•­
            log('info', 'ğŸ’¡ ê¶Œì¥ í•´ê²° ë°©ë²•:');
            log('info', '1. ë¸Œë¼ìš°ì €ì—ì„œ Ctrl+F5 (ê°•ì œ ìƒˆë¡œê³ ì¹¨)');
            log('info', '2. ë¸Œë¼ìš°ì € ìºì‹œ ì™„ì „ ì‚­ì œ');
            log('info', '3. ì‹œí¬ë¦¿/ì¸ì½”ê·¸ë‹ˆí†  ëª¨ë“œì—ì„œ ì ‘ì†');
            log('info', '4. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸');
            log('info', '5. ê°œë°œì ë„êµ¬ Console íƒ­ í™•ì¸');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', () => {
            log('info', 'ê¸´ê¸‰ ë””ë²„ê·¸ ëª¨ë“œ ë¡œë“œ ì™„ë£Œ');
            log('info', `í˜„ì¬ ì‹œê°„: ${new Date().toLocaleString()}`);
            log('info', `ë¸Œë¼ìš°ì €: ${navigator.userAgent}`);
            log('info', 'ì§„ë‹¨í•  í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”...');
        });
    </script>
</body>
</html>